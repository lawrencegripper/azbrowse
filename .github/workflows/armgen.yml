name: ARM Spec Updater

on:
  workflow_dispatch:
  schedule:
  - cron: "0 17 * * 1"

jobs:
  stale:

    runs-on: ubuntu-18.04
    
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    - name: Build devcontainer for tooling
      run: sudo -E make devcontainer

    - name: Run swagger-update to pull latest specs from azure specs repo
      run: CMD='make swagger-update' sudo -E make devcontainer-run


    - name: Run swagger-codegen to gen go types
      run: CMD='make swagger-codegen' sudo -E make devcontainer-run

    - name: Sort file permissions
      run: sudo chown -R $(whoami) .

    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v3
      with:
        commit-message: ðŸ§¹ Update ARM Specs
        title: Update ARM Specs
        body: Automated PR generated by the ARM Spec Updater action
        branch: update-arm-spec
        base: main
